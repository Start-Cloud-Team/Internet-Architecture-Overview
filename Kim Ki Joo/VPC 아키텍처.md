# 2025-11-05 자료조사 : VPC 아키텍처

- ***아키텍처 이미지***
    
    > V 1.0
    > 
    
    ![SCT_VPC_아키텍처.png](images/SCT_VPC_%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5.png)
    
    - 피드백
        1. 일단 이건 VPC 아키텍처가 아니라 전체 아키텍처로 보입니다. 물론 함께 포함시켜도 되지만, 너무 복잡하다 느껴져요. 아키텍처는 한눈에 파이프라인의 흐름을 이해할 수 있어야 하는데, 한 눈에 보이는게 아니라 그래서 이게 뭐지..? 라는 생각밖에 안들어요. 제 생각에는 그 이유가 두 가지인 것 같은데, 우선 앞서 설명한 VPC랑 파이프라인 아키텍처가 분리되지 않고 하나로 합쳐져서 그런 것 같습니다. 또 다른 이유 하나는 화살표가 너무 난잡해요.. 꺾이지 않아도 되는 부분에 꺾여있고, 흐름이 아니라 그냥 연결선을 표현하는 화살표라고 보여요.. 그래서 이거 관련해서 아키텍처를 분리해보거나, 화살표를 깔끔히 정리해주세요. 화살표 정리를 해도 정신이 없으면 화살표 옆에 숫자를 적어서 흐름을 이해하기 쉽게 해주세요. 그 화살표는 제 저번 발표 ppt 참고하시면 됩니다.
        2. 왜 저 위치에 저게 있지? 싶은게 너무 많습니다. private subnet에 coudbuild가 정말 위치하는게 맞는지 확인해주세요. vpc 엔드포인트는 제가 잘 몰라서 이건 찾아보고 피드백 드릴텐데, 뭐가 됐던 private subnet 부분에 너무 부가적이고 없어도 되는 것 같은 서비스들이 위치해 있다고 생각합니다.
        3. cicd 파이프라인이 눈에 안보입니다.. 이건 1번 피드백이랑 연관되는 것 같은데, 어디서 빌드가 진행되고, 어디서 배포되고,, 그 후에 블루그린이 어떻게 되고.. 이런 내용 잘 보이게 다시 구성해주세요!
    
    > V 1.1
    > 
    
    ![SCT_VPC_아키텍처2.png](images/SCT_VPC_%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%202.png)
    
    - 서비스용 VPC랑 개발을 위한 블루그린용 VPC를 설정
    - 피드백
        
        이런 방식으로 해도 좋지만, 프로젝트에서는 “이렇게 해야할까요?’
        
    
    > V.1.2
    > 
    
    ![SCT_VPC_아키텍처1.png](images/SCT_VPC_%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5%201.png)
    
- VPC 안에 통신을 위한 IGW가 있고, ABL로 들어오거나 나가는 요청들을 지능적으로 판단해서 각 AZ로 보내주는 역할을 하고, AZ마다 프라이빗에 Fargate 작업이 있고, 필요한 정보가 있다면, Fargate의 요청을 퍼블릭으로 보내주는 NAT GateWay가 통신으로 외부 인터넷에 나가주는 역할.
- ***세부 내용 정리***
    - VPC 목표
        - 내부에 Fargate 컨테이너에 배포를 목표
        - IGW(인터넷 게이트웨이)로 외부 신호가 들어오면, ALB가 트래픽에 맞게 연결되어있는 신호로 전송하는 것이 특징
        - VPC 제작
            - ***설정값***
            - IPv4 CIDR : 10.0.0.0/16
            - AZ : 2개 (-a, -c)
            - 퍼블릭 서브넷, 프라이빗 서브넷 : 각 2개씩
            - NAT 게이트웨이 : AZ 1개씩 (2개)
            - VPC 엔드포인트 : 미 설정
        - 보안그룹
            - Bwapp-Alb-sg
                - 인바운드 규칙 : HTTP (80) 0.0.0.0/0
                - 아웃바운드 규칙 : 모든 트래픽 (전체) Bwapp-Ecs-sg
            - Bwapp-ECS-sg
                - 인바운드 규칙 : 사용자 지정 TCP (7890) Bwapp-Alb-sg
                - 아웃바운드 규칙 : 모든 트래픽 (전체) 0.0.0.0/0
                
        - ALB
            - 보안그룹
                - Bwapp-Alb-sg
            - 리스너 HTTP:80
                - 대상그룹으로 전달
                    - Bwapp-tg-Blue(50%)
                    - Bwapp-tg-Green (50%)
                
        - 대상그룹
            - Bwapp-tg-Green
                - 프로토콜:포트  : HTTP:80
                - 대상 IP주소 : 10.0.3.153:7890 (Unhealthy)
            - Bwapp-tg-Blue
                - 프로토콜:포트  : HTTP:80
                - 대상 IP주소 : 10.0.3.153:7890 (Unhealthy)
            - Bwapp-tg-Test
                - 프로토콜:포트  : HTTP:7890
                - 대상 IP주소 : 10.0.3.153:7890 (Unhealthy)
        
    - 가용구역 AZ- a, AZ-c로 사용해야하는 이유가 뭘까요?
        - 가용구역 [-a, -b], [-c, -d]는 각각 하나의 집합으로 묶여있음. →  
        근데, -b에 문제가 생기거나, -d에 문제가 생기면 묶여있는 -a나 -c도 같이 먹통이 될 수 있음
        - -a, -c는 비교적 생성된지 오래되어서 안정성이 높지만, 반대로
        -b, -d는 최근에 생성되어서 문제를 일으키는 일이 있는 경우가 있음.
